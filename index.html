<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pizza Sas√† TIME AOO¬∑ Spedisci pizze dove e quando vuoi</title>
  <meta name="description" content="Pizza SASA" />
  <style>
    :root{ --bg:#0b0f14; --panel:#111722; --text:#e8f0ff; --muted:#93a4c0; --accent:#ffb703; --accent2:#fb8500; --ok:#aaf0d1; --warn:#ff7481; --line:#ffffff18 }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans;background:radial-gradient(1200px 800px at 20% -10%, #142034, var(--bg));color:var(--text);line-height:1.5}
    .container{max-width:980px;margin:0 auto;padding:24px}
    header{text-align:center;padding:28px 0 18px;position:relative}
    .brand{display:inline-block;font-weight:900;letter-spacing:.02em;text-transform:uppercase;font-size:clamp(22px,4vw,34px);color:var(--accent);text-shadow:0 0 20px #fb850055}
    .subtitle{color:var(--muted);margin-top:6px}
    .panel{background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));border:1px solid var(--line);border-radius:18px;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.03)}
    .banner{border:1px dashed rgba(255,255,255,.25);border-radius:14px;padding:14px;margin:12px 0;background:rgba(251,133,0,.08);color:var(--accent2)}
    .row{display:flex;gap:14px;flex-wrap:wrap;align-items:flex-end}
    label{display:block;font-weight:700;margin:6px 0;color:var(--muted)}
    input[type='text'], input[type='date'], input[type='time']{
      width:100%;padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.12);
      background:#0e1420;color:var(--text);outline:none;box-shadow:inset 0 1px 0 rgba(255,255,255,.04);font-size:16px;
    }
    .btn{appearance:none;border:0;border-radius:12px;padding:12px 16px;font-weight:800;background:linear-gradient(180deg,#ffb703,#fb8500);color:#0b0f14;cursor:pointer;box-shadow:0 8px 20px rgba(251,133,0,.35);transition:transform .08s ease, box-shadow .2s ease;white-space:nowrap}
    .btn:hover{transform:translateY(-1px);box-shadow:0 12px 26px rgba(251,133,0,.5)}
    .btn:active{transform:translateY(0)}
    .btn-secondary{background:linear-gradient(180deg,#2b3344,#1c2432);color:var(--text);box-shadow:0 8px 20px rgba(0,0,0,.35)}
    .status{margin-top:10px;font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, 'Liberation Mono', monospace}
    .status.warn{color:var(--warn)} .status.ok{color:var(--ok)}
    .hidden{display:none}
    .divider{height:1px;background:linear-gradient(90deg, transparent, rgba(255,255,255,.12), transparent);margin:22px 0}
    .telex{background:#10161f;border-left:4px solid var(--ok);padding:12px 14px;border-radius:10px;font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;color:#d9ffe8;box-shadow:inset 0 0 0 1px rgba(255,255,255,.06)}
    footer{padding:22px 0;color:var(--muted);text-align:center;font-size:14px}
    .small{font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">Pizza Taxi</div>
      <div class="subtitle">Spedisci pizze dove e <em>quando</em> vuoi ¬∑ Accesso con numero dal nastro</div>
    </header>

    <section class="panel">
      <!-- Gate di accesso -->
      <div class="banner">üéß <strong>Accesso riservato</strong> ‚Äî Inserisci il <em>numero del nastro</em> (AOOO) per entrare nel sistema spedizioni.</div>
      <div class="row">
        <div style="flex:1 1 360px">
          <label for="regNumber">Numero del nastro (solo cifre)</label>
          <input id="regNumber" type="text" inputmode="numeric" autocomplete="off" placeholder="es. 0812345678" aria-describedby="hintReg" />
          <div id="hintReg" class="small">√à la sequenza di toni DTMF che si sente nell'audio.</div>
        </div>
        <button id="doRegister" class="btn" style="flex:0 0 auto;">ACCEDI</button>
      </div>
      <div id="status" class="status" aria-live="polite"></div>

      <!-- Form spedizione (si sblocca dopo l'accesso) -->
      <div id="ship" class="hidden">
        <div class="divider"></div>
        <div class="banner">üçï <strong>Crea spedizione</strong> ‚Äî Imposta <em>luogo</em>, <em>data</em> e <em>ora</em> della consegna.</div>

        <div class="row">
          <div style="flex:2 1 420px">
            <label for="place">Luogo di consegna</label>
            <input id="place" type="text" placeholder="(es.) Piazza XX Settembre, bar Carillon" />
          </div>
          <div style="flex:1 1 180px">
            <label for="date">Data</label>
            <input id="date" type="date" />
          </div>
          <div style="flex:1 1 140px">
            <label for="time">Ora</label>
            <input id="time" type="time" />
          </div>
        </div>

        <div class="row" style="margin-top:10px">
          <button id="finalize" class="btn">Conferma spedizione</button>
        </div>
      </div>

      <!-- Ricevuta -->
      <div id="receipt" class="hidden" style="margin-top:16px">
        <div class="divider"></div>
        <div class="telex">
          <div><strong>PIZZA TAXI ¬∑ CONFERMA</strong></div>
          <div id="rx-ts" class="small">Data: ‚Äî</div>
          <div>Registrazione: <span id="rx-reg"></span></div>
          <div>Luogo: <span id="rx-place"></span></div>
          <div>Consegna: <span id="rx-when"></span></div>
        </div>
        <div class="small" style="margin-top:8px">Mostra questa conferma allo <strong>Sportello Archivio</strong>.</div>
        <div class="row" style="margin-top:10px">
          <button id="reset" class="btn-secondary">Nuova spedizione</button>
          <button id="print" class="btn-secondary">Stampa</button>
        </div>
      </div>
    </section>

    <footer>¬© Pizza Taxi ‚Äî prototipo statico. Nessun dato inviato a server finch√© non abiliti il Worker.</footer>
  </div>

  <script>
    // ====== CONFIG ======
    // Quando crei il Cloudflare Worker, incolla qui il suo URL.
    // Esempio: const CHECK_URL = "https://check.tuosubdomain.workers.dev";
    const CHECK_URL = "https://cold-cell-f338.salvatorestaianoapple.workers.dev"; // se vuoto ‚Üí "solo frizione"

    // ====== UTILS ======
    const el = id => document.getElementById(id);
    const $reg = el('regNumber');
    const $doRegister = el('doRegister');
    const $status = el('status');
    const $ship = el('ship');
    const $place = el('place');
    const $date = el('date');
    const $time = el('time');
    const $finalize = el('finalize');
    const $receipt = el('receipt');
    const $rxTs = el('rx-ts');
    const $rxReg = el('rx-reg');
    const $rxPlace = el('rx-place');
    const $rxWhen = el('rx-when');
    const $reset = el('reset');
    const $print = el('print');

    const digitsOnly = v => (v||'').replace(/\\D+/g,'');
    const setStatus = (t, type='') => { $status.className = 'status' + (type? ' '+type:''); $status.textContent = t; };
    const fmtNow = () => new Date().toLocaleString('it-IT', { dateStyle:'medium', timeStyle:'short' });

    // Preimposta una data scenica
    (function(){ $date.value = '1975-09-15'; $time.value = '19:30'; })();

    async function checkWithWorker(candidate){
      if(!CHECK_URL) return { ok:true, mode:'friction' }; // niente verifica remota
      const res = await fetch(CHECK_URL, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ candidate }) });
      if(!res.ok) throw new Error('endpoint non raggiungibile');
      return await res.json();
    }

    $doRegister.addEventListener('click', async () => {
      const candidate = digitsOnly($reg.value);
      if(!/^\\d{7,12}$/.test(candidate)) { setStatus('Inserisci 7‚Äì12 cifre decodificate dai DTMF.', 'warn'); return; }
      try{
        setStatus('‚è≥ Verifica accesso‚Ä¶');
        const data = await checkWithWorker(candidate);
        if(!data.ok){ setStatus('‚ùå Accesso negato. Ricontrolla la sequenza di toni.', 'warn'); $ship.classList.add('hidden'); return; }
        setStatus('‚úÖ Accesso consentito. Imposta la spedizione.', 'ok');
        $ship.classList.remove('hidden');
        $rxReg.textContent = candidate;
      }catch(e){ setStatus('Errore di rete. Riprovare tra poco.', 'warn'); }
    });

    $finalize.addEventListener('click', () => {
      const place = ($place.value||'').trim();
      const date = $date.value; const time = $time.value;
      if(!place){ setStatus('Specifica un luogo di consegna.', 'warn'); return; }
      if(!date || !time){ setStatus('Imposta data e ora.', 'warn'); return; }
      $rxTs.textContent = 'Conferma generata: ' + fmtNow();
      $rxPlace.textContent = place;
      $rxWhen.textContent = `${date} ${time}`;
      $receipt.classList.remove('hidden');
      setStatus('üßæ Spedizione registrata. Mostra la conferma al desk.', 'ok');
      window.scrollTo({ top: document.body.scrollHeight, behavior:'smooth' });
    });

    $reset.addEventListener('click', () => {
      $place.value=''; $receipt.classList.add('hidden'); setStatus(''); window.scrollTo({ top: 0, behavior:'smooth' });
    });

    $print.addEventListener('click', () => window.print());

    // Invio con Enter
    $reg.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); $doRegister.click(); }});
  </script>
</body>
</html>



